{% load wagtailcore_tags i18n %}

<section class="benefit gray_section gallery_section" style="padding: 60px 0;">
    <div class="container">

        <div class="row align-items-center justify-content-center mb-5">
            <div class="col-12 text-center">
                <h2>{{ value.title }}</h2>
                {% if value.description %}
                    <p>{{ value.description }}</p>
                {% endif %}
            </div>
        </div>

        <div class="row justify-content-center" id="gallery-grid">

            {% if max_count %}
                 {# --- Режим импорта на Главной --- #}
                 {% for block in value.items|slice:max_count %}
                    {% include_block block %}
                 {% endfor %}

            {% elif gallery_items %}
                 {# --- Режим Галереи (С пагинацией) --- #}

                 {# 1. Выводим первую страницу #}
                 {% for block in gallery_items %}
                    {% include_block block %}
                 {% endfor %}

                 {# 2. Выводим кнопку (копируем логику из partial для первой страницы) #}
                 {% if gallery_items.has_next %}
                    <div id="gallery-load-wrapper-{{ gallery_items.next_page_number }}" class="col-12 text-center mt-4 w-100">
                        <button
                            class="button button_transparent"
                            hx-get="?page={{ gallery_items.next_page_number }}"
                            hx-target="#gallery-load-wrapper-{{ gallery_items.next_page_number }}"
                            hx-swap="outerHTML"
                            hx-indicator="#gallery-loader">
                            {% trans "Посмотреть еще" %}
                        </button>

                        <div id="gallery-loader" class="htmx-indicator" style="display:none; margin-top: 10px;">
                            {% trans "Загрузка..." %}
                        </div>
                    </div>
                {% endif %}

            {% else %}
                 {# Fallback #}
                 {% for block in value.items %}
                    {% include_block block %}
                 {% endfor %}
            {% endif %}

        </div>

        {# Кнопка для режима импорта #}
        {% if show_link and gallery_url %}
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="{{ gallery_url }}" class="button button_transparent">{% trans "Смотреть всю галерею" %}</a>
            </div>
        </div>
        {% endif %}
    </div>
</section>
