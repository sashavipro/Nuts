{% load wagtailcore_tags wagtailimages_tags %}

<section class="section contacts-page" style="padding: 60px 0;">
    <div class="container">
        <div class="row">
            {# === ЛЕВАЯ КОЛОНКА (Инфо) === #}
            <div class="col-lg-5 col-12 mb-5 mb-lg-0">

                {% if self.main_title %}
                <h1 style="font-weight: 800; font-size: 48px; color: #1A2F3F; margin-bottom: 50px;">
                    {{ self.main_title }}
                </h1>
                {% endif %}

                {# 1. ТЕЛЕФОНЫ И СОЦСЕТИ #}
                {% if self.phone_section %}
                <div class="contact-row d-flex align-items-start mb-5">

                    {# Иконка Секции #}
                    <div class="icon-wrap mr-3" style="width: 24px; min-width: 24px;">
                        {% if self.phone_section.icon_type == 'font' and self.phone_section.icon_font_class %}
                            <i class="nut-icon {{ self.phone_section.icon_font_class }}" style="font-size: 24px; color: #337D5A;"></i>
                        {% elif self.phone_section.icon_type == 'image' and self.phone_section.icon_image %}
                            {% image self.phone_section.icon_image original style="width: 100%; height: auto;" %}
                        {% endif %}
                    </div>

                    <div class="content-wrap d-flex flex-wrap align-items-center">
                        {# Список номеров #}
                        <div class="phones mr-4">
                            {% for phone in self.phone_section.phones %}
                                <a href="tel:{{ phone }}" class="d-block" style="color: #1A2F3F; font-size: 18px; line-height: 1.5; text-decoration: none;">
                                    {{ phone }}
                                </a>
                            {% endfor %}
                        </div>

                        {# Соцсети #}
                        {% if self.phone_section.socials %}
                        <div class="socials d-flex align-items-center mt-2 mt-sm-0">
                            {% for social in self.phone_section.socials %}
                                {# Убрали width, height, background и color: white. Добавили отступ справа. #}
                                <a href="{{ social.link }}" target="_blank" class="social-link" style="margin-right: 15px; text-decoration: none; line-height: 1;">

                                    {# Иконка Шрифтовая #}
                                    {% if social.icon_type == 'font' and social.icon_font_class %}
                                        {# Задаем размер 24px и цвет #337D5A (зеленый), чтобы сочеталось с телефоном #}
                                        <i class="nut-icon {{ social.icon_font_class }}" style="font-size: 24px; color: #337D5A;"></i>

                                    {# Иконка Картинка #}
                                    {% elif social.icon_type == 'image' and social.icon_image %}
                                        {% image social.icon_image original style="width: 24px; height: auto;" %}
                                    {% endif %}

                                </a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {# 2. EMAIL #}
                {% if self.email_section and self.email_section.email %}
                <div class="contact-row d-flex align-items-center mb-5">
                    {# Иконка Email #}
                    <div class="icon-wrap mr-3" style="width: 24px; min-width: 24px;">
                        {% if self.email_section.icon_type == 'font' and self.email_section.icon_font_class %}
                            <i class="nut-icon {{ self.email_section.icon_font_class }}" style="font-size: 24px; color: #337D5A;"></i>
                        {% elif self.email_section.icon_type == 'image' and self.email_section.icon_image %}
                            {% image self.email_section.icon_image original style="width: 100%; height: auto;" %}
                        {% endif %}
                    </div>

                    <div class="content-wrap">
                        <a href="mailto:{{ self.email_section.email }}" style="color: #1A2F3F; font-size: 18px; text-decoration: none;">
                            {{ self.email_section.email }}
                        </a>
                    </div>
                </div>
                {% endif %}

                {# 3. АДРЕСА #}
                {% for addr in self.addresses %}
                    <div class="contact-row d-flex align-items-start mb-5">
                        {# Иконка Адреса #}
                        <div class="icon-wrap mr-3" style="width: 24px; min-width: 24px; margin-top: 5px;">
                            {% if addr.icon_type == 'font' and addr.icon_font_class %}
                                <i class="nut-icon {{ addr.icon_font_class }}" style="font-size: 24px; color: #337D5A;"></i>
                            {% elif addr.icon_type == 'image' and addr.icon_image %}
                                {% image addr.icon_image original style="width: 100%; height: auto;" %}
                            {% endif %}
                        </div>

                        <div class="content-wrap">
                            {% if addr.title %}
                                <h3 style="font-size: 20px; font-weight: 700; color: #1A2F3F; margin-bottom: 10px;">
                                    {{ addr.title }}
                                </h3>
                            {% endif %}
                            <div class="address-text" style="color: #1A2F3F; font-size: 16px; line-height: 1.6;">
                                {{ addr.text|richtext }}
                            </div>
                        </div>
                    </div>
                {% endfor %}

            </div>

            {# === ПРАВАЯ КОЛОНКА (Карта) === #}
            <div class="col-lg-7 col-12">
                {% if self.map_embed %}
                <div class="map-wrapper" style="width: 100%; height: 100%; min-height: 500px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                    <div style="position: relative; width: 100%; height: 100%; padding-bottom: 75%;">
                        <div class="iframe-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                             {{ self.map_embed|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<style>
    .iframe-container iframe {
        width: 100% !important;
        height: 100% !important;
        border: none;
    }
    .social-link i {
        display: flex; /* Чтобы иконка шрифта центрировалась */
    }
</style>
